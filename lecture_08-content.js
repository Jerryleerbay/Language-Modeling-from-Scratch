addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 16}], "This lecture: distributed training across multiple GPUs", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 18}], "Situation: compute (arithmetic logic units) is spread out, communication is slow", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 20}], "Hierarchy", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 21}], "- L1 cache / shared memory (small, fast)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 22}], "- L2 cache", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 23}], "- DRAM", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 24}], "- Single node, multi-GPU", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 25}], "- Multi-node, multi-GPU (big, slow)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 27}], "Last week: reduce DRAM accesses via fusion/tiling", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 28}], "This week: reduce communication across GPUs/nodes via replication/sharding", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 30}], "Game: organize computation so that communication is minimized", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 32}], "## Part 1: building blocks of distributed communication/computation", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 57}], "## Single GPU", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 58}], "https://miro.medium.com/v2/resize:fit:2000/format:webp/1*6xoBKi5kL2dZpivFe1-zgw.jpeg", {"width": "100%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 59}], "Memory bandwidth for DRAM for H100 NVL is 7.8 TB/sec", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 59}], "https://resources.nvidia.com/en-us-tensor-core/nvidia-tensor-core-gpu-datasheet", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 61}], "## Multi-node, multi-GPU", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 63}], "Traditionally:", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 64}], "https://media.springernature.com/lw685/springer-static/image/art%3A10.1186%2Fs42774-021-00098-3/MediaObjects/42774_2021_98_Fig1_HTML.png?as=webp", {"width": "40.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 65}], "- GPUs on same node communicate via a PCI(e) bus (v7.0, 16 lanes => 242 GB/sec)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 65}], "https://en.wikipedia.org/wiki/PCI_Express", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 66}], "- GPUs on different nodes communicate via Ethernet (~200 MB/sec)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 68}], "Both are too slow...", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 69}], "Key hardware advance: have GPUs connect *directly*, bypassing CPU", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 71}], "## InfiniBand", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 73}], "Standard developed in 1999; Mellanox created InfiniBand hardware, acquired by NVIDIA in 2019", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 74}], "Idea: Remote Direct Memory Access (RDMA) to connect nodes directly", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 75}], "https://lambdalabs.com/hubfs/Imported_Blog_Media/nvlink-diagram-update.png", {"width": "60.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 77}], "## NVLink/NVSwitch", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 79}], "NVIDIA developed proprietary protocol since 2014", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 80}], "4.5x more bandwidth than InfiniBand", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 81}], "https://developer.nvidia.com/blog/upgrading-multi-gpu-interconnectivity-with-the-third-generation-nvidia-nvswitch/", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 83}], "Within a node: NVLink connects GPUs directly, bypass CPU", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 84}], "https://developer-blogs.nvidia.com/wp-content/uploads/2022/08/NVLink-generations-1.png", {"width": "60.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 86}], "Across nodes: NVSwitch connects GPUs directly, bypass Ethernet", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 87}], "https://developer-blogs.nvidia.com/wp-content/uploads/2022/08/NVLink-all-to-all-connectivity-1.png", {"width": "60.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 89}], "H100 (Hopper): 18 NVLink 4.0 links => 900GB/sec", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 91}], "Bonus: NVSwitch has SHARP acceleration, which halves the communication for all-reduce", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 92}], "https://developer-blogs.nvidia.com/wp-content/uploads/2022/08/NVLink-SHARP-acceleration-1.png", {"width": "60.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 93}], "Will likely be many other hardware innovations in future", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 95}], "Let's check what our hardware setup is.", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 95}], "https://guide.ncloud-docs.com/docs/en/server-baremetal-a100-check-vpc", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "\tGPU0\tGPU1\tGPU2\tGPU3\tGPU4\tGPU5\tGPU6\tGPU7\tNIC0\tNIC1\tNIC2\tNIC3\tNIC4\tNIC5\tNIC6\tNIC7\tNIC8\tNIC9\tNIC10\tNIC11\tNIC12\tNIC13\tNIC14\tNIC15\tNIC16\tNIC17\tCPU Affinity\tNUMA Affinity\tGPU NUMA ID", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "GPU0\t X \tNV18\tNV18\tNV18\tNV18\tNV18\tNV18\tNV18\tPXB\tPXB\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t0-55,112-167\t0\t\tN/A", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "GPU1\tNV18\t X \tNV18\tNV18\tNV18\tNV18\tNV18\tNV18\tNODE\tNODE\tNODE\tPXB\tPXB\tNODE\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t0-55,112-167\t0\t\tN/A", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "GPU2\tNV18\tNV18\t X \tNV18\tNV18\tNV18\tNV18\tNV18\tNODE\tNODE\tNODE\tNODE\tNODE\tPXB\tPXB\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t0-55,112-167\t0\t\tN/A", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "GPU3\tNV18\tNV18\tNV18\t X \tNV18\tNV18\tNV18\tNV18\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tPXB\tPXB\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t0-55,112-167\t0\t\tN/A", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "GPU4\tNV18\tNV18\tNV18\tNV18\t X \tNV18\tNV18\tNV18\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tPXB\tPXB\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\t56-111,168-223\t1\t\tN/A", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "GPU5\tNV18\tNV18\tNV18\tNV18\tNV18\t X \tNV18\tNV18\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tPXB\tPXB\tNODE\tNODE\tNODE\tNODE\t56-111,168-223\t1\t\tN/A", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "GPU6\tNV18\tNV18\tNV18\tNV18\tNV18\tNV18\t X \tNV18\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tNODE\tPXB\tPXB\tNODE\tNODE\t56-111,168-223\t1\t\tN/A", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "GPU7\tNV18\tNV18\tNV18\tNV18\tNV18\tNV18\tNV18\t X \tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tPXB\tPXB\t56-111,168-223\t1\t\tN/A", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC0\tPXB\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\t X \tPIX\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC1\tPXB\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tPIX\t X \tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC2\tNODE\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\t X \tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC3\tNODE\tPXB\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\t X \tPIX\tNODE\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC4\tNODE\tPXB\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tPIX\t X \tNODE\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC5\tNODE\tNODE\tPXB\tNODE\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tNODE\t X \tPIX\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC6\tNODE\tNODE\tPXB\tNODE\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tNODE\tPIX\t X \tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC7\tNODE\tNODE\tNODE\tPXB\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\t X \tPIX\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC8\tNODE\tNODE\tNODE\tPXB\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tPIX\t X \tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC9\tSYS\tSYS\tSYS\tSYS\tPXB\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\t X \tPIX\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC10\tSYS\tSYS\tSYS\tSYS\tPXB\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tPIX\t X \tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC11\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\t X \tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC12\tSYS\tSYS\tSYS\tSYS\tNODE\tPXB\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\t X \tPIX\tNODE\tNODE\tNODE\tNODE\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC13\tSYS\tSYS\tSYS\tSYS\tNODE\tPXB\tNODE\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tPIX\t X \tNODE\tNODE\tNODE\tNODE\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC14\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tPXB\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tNODE\t X \tPIX\tNODE\tNODE\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC15\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tPXB\tNODE\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tNODE\tPIX\t X \tNODE\tNODE\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC16\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tPXB\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\t X \tPIX\t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC17\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tPXB\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tSYS\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tNODE\tPIX\t X \t\t\t\t", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "Legend:", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  X    = Self", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  SYS  = Connection traversing PCIe as well as the SMP interconnect between NUMA nodes (e.g., QPI/UPI)", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NODE = Connection traversing PCIe as well as the interconnect between PCIe Host Bridges within a NUMA node", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  PHB  = Connection traversing PCIe as well as a PCIe Host Bridge (typically the CPU)", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  PXB  = Connection traversing multiple PCIe bridges (without traversing the PCIe Host Bridge)", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  PIX  = Connection traversing at most a single PCIe bridge", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NV#  = Connection traversing a bonded set of # NVLinks", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "NIC Legend:", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC0: mlx5_0", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC1: mlx5_1", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC2: mlx5_2", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC3: mlx5_3", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC4: mlx5_4", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC5: mlx5_5", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC6: mlx5_6", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC7: mlx5_7", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC8: mlx5_8", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC9: mlx5_9", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC10: mlx5_10", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC11: mlx5_11", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC12: mlx5_12", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC13: mlx5_13", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC14: mlx5_14", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC15: mlx5_15", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC16: mlx5_16", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "  NIC17: mlx5_17", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 97}, {"name": "note_system", "filename": "lecture_08.py", "lineno": 710}], "", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 33}, {"name": "hardware", "filename": "lecture_08.py", "lineno": 98}], "Note GPUs are connected via NV18, also connected to NICs (for PCIe)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 102}], "Collective operations are the conceptual primitives used for distributed programming", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 102}], "https://en.wikipedia.org/wiki/Collective_operation", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 104}], "- Collective means that specify communication pattern across many (e.g., 256) nodes", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 105}], "- These are classic in the parallel programming literature from the 1980s", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 106}], "- For SIMD (Single Instruction, Multiple Data) parallelism", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 107}], "- Better/faster abstraction than managing point-to-point communication yourself", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 109}], "Terminology:", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 110}], "- Rank: a device (e.g., GPU)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 111}], "- World size: number of devices", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 113}], "## Broadcast", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 113}], "https://pytorch.org/tutorials/_images/broadcast.png", {"width": "30.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 115}], "## Scatter", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 115}], "https://pytorch.org/tutorials/_images/scatter.png", {"width": "30.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 117}], "## Gather", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 117}], "https://pytorch.org/tutorials/_images/gather.png", {"width": "30.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 119}], "## Reduce", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 119}], "https://pytorch.org/tutorials/_images/reduce.png", {"width": "30.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 121}], "## All-gather", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 121}], "https://pytorch.org/tutorials/_images/all_gather.png", {"width": "30.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 123}], "## Reduce-scatter", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 123}], "https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/_images/reducescatter.png", {"width": "30.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 125}], "## All-reduce = reduce-scatter + all-gather", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 125}], "https://pytorch.org/tutorials/_images/all_reduce.png", {"width": "30.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 127}], "Framework to think about it:", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 128}], "- Reduce: performs some associative/commutative operation (sum, min, max)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 129}], "- Broadcast/scatter is inverse of gather", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 34}, {"name": "collective_operations", "filename": "lecture_08.py", "lineno": 130}], "- All: destination is all", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 134}], "## PyTorch distributed library (`torch.distributed`)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 136}], "Reference", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 136}], "https://pytorch.org/docs/stable/distributed.html", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 138}], "- Provides clean interface for collective operations", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 138}], "<function all_reduce at 0x14ea591569e0>", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 139}], "- Backends: gloo (CPU), nccl (GPU)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 140}], "- Also supports higher-level abstractions", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 140}], "<class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 142}], "## NVIDIA Collective Communication Library (NCCL)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 144}], "NCCL translates collective operations into low-level packets.", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 145}], "https://www.nvidia.com/en-us/on-demand/session/gtcspring21-s31880/", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 147}], "1. Detect toplogy of hardware (e.g., number of nodes, switches, NVLink/PCIe)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 148}], "2. Optimize the path between ranks; ring (good bandwidth), tree (good latency)", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 149}], "https://developer-blogs.nvidia.com/wp-content/uploads/2019/02/DBtree.png", {"width": "40.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 150}], "3. Launches CUDA kernels to send/receive data", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 152}], "## Examples", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 35}, {"name": "torch_distributed", "filename": "lecture_08.py", "lineno": 153}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 4)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 164}], "### All-reduce", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 169}], "Rank 3 [before all-reduce]: tensor([3., 4., 5., 6.], device='cuda:3')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 169}], "Rank 1 [before all-reduce]: tensor([1., 2., 3., 4.], device='cuda:1')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 169}], "Rank 2 [before all-reduce]: tensor([2., 3., 4., 5.], device='cuda:2')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 169}], "Rank 0 [before all-reduce]: tensor([0., 1., 2., 3.], device='cuda:0')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 171}], "Rank 2 [after all-reduce]: tensor([ 6., 10., 14., 18.], device='cuda:2')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 171}], "Rank 1 [after all-reduce]: tensor([ 6., 10., 14., 18.], device='cuda:1')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 171}], "Rank 3 [after all-reduce]: tensor([ 6., 10., 14., 18.], device='cuda:3')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 171}], "Rank 0 [after all-reduce]: tensor([ 6., 10., 14., 18.], device='cuda:0')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 175}], "### Reduce-scatter", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 181}], "Rank 0 [before reduce-scatter]: input = tensor([0., 1., 2., 3.], device='cuda:0'), output = tensor([0.], device='cuda:0')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 181}], "Rank 3 [before reduce-scatter]: input = tensor([3., 4., 5., 6.], device='cuda:3'), output = tensor([0.], device='cuda:3')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 181}], "Rank 2 [before reduce-scatter]: input = tensor([2., 3., 4., 5.], device='cuda:2'), output = tensor([0.], device='cuda:2')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 181}], "Rank 1 [before reduce-scatter]: input = tensor([1., 2., 3., 4.], device='cuda:1'), output = tensor([0.], device='cuda:1')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 183}], "Rank 0 [after reduce-scatter]: input = tensor([0., 1., 2., 3.], device='cuda:0'), output = tensor([6.], device='cuda:0')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 183}], "Rank 3 [after reduce-scatter]: input = tensor([3., 4., 5., 6.], device='cuda:3'), output = tensor([18.], device='cuda:3')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 183}], "Rank 1 [after reduce-scatter]: input = tensor([1., 2., 3., 4.], device='cuda:1'), output = tensor([10.], device='cuda:1')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 183}], "Rank 2 [after reduce-scatter]: input = tensor([2., 3., 4., 5.], device='cuda:2'), output = tensor([14.], device='cuda:2')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 187}], "### All-gather", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 193}], "Rank 0 [before all-gather]: input = tensor([6.], device='cuda:0'), output = tensor([ 6., 10., 14., 18.], device='cuda:0')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 193}], "Rank 1 [before all-gather]: input = tensor([10.], device='cuda:1'), output = tensor([1., 2., 3., 4.], device='cuda:1')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 193}], "Rank 3 [before all-gather]: input = tensor([18.], device='cuda:3'), output = tensor([3., 4., 5., 6.], device='cuda:3')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 193}], "Rank 2 [before all-gather]: input = tensor([14.], device='cuda:2'), output = tensor([2., 3., 4., 5.], device='cuda:2')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 195}], "Rank 3 [after all-gather]: input = tensor([18.], device='cuda:3'), output = tensor([ 6., 10., 14., 18.], device='cuda:3')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 195}], "Rank 1 [after all-gather]: input = tensor([10.], device='cuda:1'), output = tensor([ 6., 10., 14., 18.], device='cuda:1')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 195}], "Rank 0 [after all-gather]: input = tensor([6.], device='cuda:0'), output = tensor([ 6., 10., 14., 18.], device='cuda:0')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 195}], "Rank 2 [after all-gather]: input = tensor([14.], device='cuda:2'), output = tensor([ 6., 10., 14., 18.], device='cuda:2')", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "collective_operations_main", "filename": "lecture_08.py", "lineno": 198}], "Recall that all-reduce = reduce-scatter + all-gather!", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 204}], "## Benchmarking", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 204}], "https://github.com/stas00/ml-engineering/blob/master/network/benchmarks/all_reduce_bench.py", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 206}], "Let's see how fast commmunication happens (will restrict to just one node).", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 208}], "### All-reduce", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 210}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 2)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 242}], "Rank 1: all_reduce(world_size=2, num_elements=1073741824) took 12 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 242}], "Rank 0: all_reduce(world_size=2, num_elements=1073741824) took 12 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 249}], "Rank 1: all_reduce estimated bandwidth = 321 GB/sec", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 249}], "Rank 0: all_reduce estimated bandwidth = 322 GB/sec", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 211}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 4)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 242}], "Rank 3: all_reduce(world_size=4, num_elements=1073741824) took 18 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 242}], "Rank 0: all_reduce(world_size=4, num_elements=1073741824) took 18 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 242}], "Rank 2: all_reduce(world_size=4, num_elements=1073741824) took 18 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 242}], "Rank 1: all_reduce(world_size=4, num_elements=1073741824) took 18 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 249}], "Rank 3: all_reduce estimated bandwidth = 335 GB/sec", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 249}], "Rank 0: all_reduce estimated bandwidth = 335 GB/sec", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 249}], "Rank 2: all_reduce estimated bandwidth = 335 GB/sec", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "all_reduce", "filename": "lecture_08.py", "lineno": 249}], "Rank 1: all_reduce estimated bandwidth = 335 GB/sec", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 213}], "### Reduce-scatter", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 215}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 2)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 275}], "Rank 1: reduce_scatter(world_size=2, num_elements=1073741824) took 15 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 275}], "Rank 0: reduce_scatter(world_size=2, num_elements=1073741824) took 15 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 282}], "Rank 1: reduce_scatter estimated bandwidth = 129 GB/sec", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 282}], "Rank 0: reduce_scatter estimated bandwidth = 129 GB/sec", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 216}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 4)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 275}], "Rank 2: reduce_scatter(world_size=4, num_elements=1073741824) took 37 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 275}], "Rank 0: reduce_scatter(world_size=4, num_elements=1073741824) took 37 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 275}], "Rank 1: reduce_scatter(world_size=4, num_elements=1073741824) took 37 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 275}], "Rank 3: reduce_scatter(world_size=4, num_elements=1073741824) took 37 ms", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 282}], "Rank 2: reduce_scatter estimated bandwidth = 82 GB/sec", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 282}], "Rank 0: reduce_scatter estimated bandwidth = 82 GB/sec", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 282}], "Rank 1: reduce_scatter estimated bandwidth = 82 GB/sec", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "reduce_scatter", "filename": "lecture_08.py", "lineno": 282}], "Rank 3: reduce_scatter estimated bandwidth = 82 GB/sec", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 218}], "Reference on reasoning about operations:", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 37}, {"name": "benchmarking", "filename": "lecture_08.py", "lineno": 218}], "https://github.com/NVIDIA/nccl-tests/blob/master/doc/PERFORMANCE.md#allreduce", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 285}], "Execution model: when launch a kernel (e.g., matmul), grid -> blocks -> threads", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 286}], "Multiple kernels execute asynchronously (A || B)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 287}], "Synchronization points: `cuda.torch.synchornize` or copy to CPU", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 288}], "Need a way to do more fine-grained synchronization and stay on GPU...", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 290}], "CUDA stream: a sequence of operations that execute in order", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 291}], "Different streams can execute concurrently", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 298}], "Simple example: need to do two operations", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 299}], "1. Matrix multiplication", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 300}], "2. Copy matrix from CPU to GPU", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 325}], "run1: [277.1, 277.2, 277.4] (mean 277.2 ms)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 38}, {"name": "cuda_streams", "filename": "lecture_08.py", "lineno": 326}], "run2: [164.3, 164.3, 164.3] (mean 164.3 ms)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 40}], "## Part 2: distributed training", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 41}], "https://uvadlc-notebooks.readthedocs.io/en/latest/_images/parallelism_strategies_overview.svg", {"width": "100.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 42}, {"name": "ddp", "filename": "lecture_08.py", "lineno": 330}], "## Distributed data parallel", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 42}, {"name": "ddp", "filename": "lecture_08.py", "lineno": 337}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 1)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 0, loss = 0.012715384364128113, params = ['1024x1024[-0.0279...]', '1024x1024[-0.0299...]', '1024x1024[-0.0279...]', '1024x1024[-0.0279...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 1, loss = 0.003215913427993655, params = ['1024x1024[-0.0269...]', '1024x1024[-0.0309...]', '1024x1024[-0.0269...]', '1024x1024[-0.0269...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 2, loss = 0.0021623121574521065, params = ['1024x1024[-0.0259...]', '1024x1024[-0.0319...]', '1024x1024[-0.0259...]', '1024x1024[-0.0262...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 3, loss = 0.002139827236533165, params = ['1024x1024[-0.0249...]', '1024x1024[-0.0328...]', '1024x1024[-0.025...]', '1024x1024[-0.0259...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 4, loss = 0.0023497692309319973, params = ['1024x1024[-0.0239...]', '1024x1024[-0.0338...]', '1024x1024[-0.024...]', '1024x1024[-0.0258...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 42}, {"name": "ddp", "filename": "lecture_08.py", "lineno": 338}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 2)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 0, loss = 0.012575341388583183, params = ['1024x1024[-0.0279...]', '1024x1024[-0.0299...]', '1024x1024[-0.0279...]', '1024x1024[-0.0279...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 1: step = 0, loss = 0.012855427339673042, params = ['1024x1024[-0.0279...]', '1024x1024[-0.0299...]', '1024x1024[-0.0279...]', '1024x1024[-0.0279...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 1, loss = 0.0031994949094951153, params = ['1024x1024[-0.0269...]', '1024x1024[-0.0309...]', '1024x1024[-0.0269...]', '1024x1024[-0.0269...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 1: step = 1, loss = 0.003232331946492195, params = ['1024x1024[-0.0269...]', '1024x1024[-0.0309...]', '1024x1024[-0.0269...]', '1024x1024[-0.0269...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 2, loss = 0.002160531934350729, params = ['1024x1024[-0.0259...]', '1024x1024[-0.0319...]', '1024x1024[-0.0259...]', '1024x1024[-0.0262...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 1: step = 2, loss = 0.0021640928462147713, params = ['1024x1024[-0.0259...]', '1024x1024[-0.0319...]', '1024x1024[-0.0259...]', '1024x1024[-0.0262...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 3, loss = 0.0021493230015039444, params = ['1024x1024[-0.0249...]', '1024x1024[-0.0328...]', '1024x1024[-0.025...]', '1024x1024[-0.0259...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 1: step = 3, loss = 0.0021303310059010983, params = ['1024x1024[-0.0249...]', '1024x1024[-0.0328...]', '1024x1024[-0.025...]', '1024x1024[-0.0259...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 4, loss = 0.002354438416659832, params = ['1024x1024[-0.0239...]', '1024x1024[-0.0338...]', '1024x1024[-0.024...]', '1024x1024[-0.0258...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 1: step = 4, loss = 0.002345099812373519, params = ['1024x1024[-0.0239...]', '1024x1024[-0.0338...]', '1024x1024[-0.024...]', '1024x1024[-0.0258...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 42}, {"name": "ddp", "filename": "lecture_08.py", "lineno": 339}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 4)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 2: step = 0, loss = 0.01320607028901577, params = ['1024x1024[-0.0279...]', '1024x1024[-0.0299...]', '1024x1024[-0.0279...]', '1024x1024[-0.0279...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 3: step = 0, loss = 0.012504784390330315, params = ['1024x1024[-0.0279...]', '1024x1024[-0.0299...]', '1024x1024[-0.0279...]', '1024x1024[-0.0279...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 1: step = 0, loss = 0.013255797326564789, params = ['1024x1024[-0.0279...]', '1024x1024[-0.0299...]', '1024x1024[-0.0279...]', '1024x1024[-0.0279...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 0, loss = 0.011894885450601578, params = ['1024x1024[-0.0279...]', '1024x1024[-0.0299...]', '1024x1024[-0.0279...]', '1024x1024[-0.0279...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 2: step = 1, loss = 0.0032447134144604206, params = ['1024x1024[-0.0269...]', '1024x1024[-0.0309...]', '1024x1024[-0.0269...]', '1024x1024[-0.0269...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 1: step = 1, loss = 0.0032702768221497536, params = ['1024x1024[-0.0269...]', '1024x1024[-0.0309...]', '1024x1024[-0.0269...]', '1024x1024[-0.0269...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 3: step = 1, loss = 0.0032199511770159006, params = ['1024x1024[-0.0269...]', '1024x1024[-0.0309...]', '1024x1024[-0.0269...]', '1024x1024[-0.0269...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 1, loss = 0.0031287132296711206, params = ['1024x1024[-0.0269...]', '1024x1024[-0.0309...]', '1024x1024[-0.0269...]', '1024x1024[-0.0269...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 3: step = 2, loss = 0.0021404684521257877, params = ['1024x1024[-0.0259...]', '1024x1024[-0.0319...]', '1024x1024[-0.0259...]', '1024x1024[-0.0262...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 1: step = 2, loss = 0.002226409036666155, params = ['1024x1024[-0.0259...]', '1024x1024[-0.0319...]', '1024x1024[-0.0259...]', '1024x1024[-0.0262...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 2: step = 2, loss = 0.0021877167746424675, params = ['1024x1024[-0.0259...]', '1024x1024[-0.0319...]', '1024x1024[-0.0259...]', '1024x1024[-0.0262...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 2, loss = 0.0020946550648659468, params = ['1024x1024[-0.0259...]', '1024x1024[-0.0319...]', '1024x1024[-0.0259...]', '1024x1024[-0.0262...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 1: step = 3, loss = 0.0022621024399995804, params = ['1024x1024[-0.0249...]', '1024x1024[-0.0328...]', '1024x1024[-0.025...]', '1024x1024[-0.0259...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 3: step = 3, loss = 0.00211203470826149, params = ['1024x1024[-0.0249...]', '1024x1024[-0.0328...]', '1024x1024[-0.025...]', '1024x1024[-0.0259...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 2: step = 3, loss = 0.0021486275363713503, params = ['1024x1024[-0.0249...]', '1024x1024[-0.0328...]', '1024x1024[-0.025...]', '1024x1024[-0.0259...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 3, loss = 0.0020365435630083084, params = ['1024x1024[-0.0249...]', '1024x1024[-0.0328...]', '1024x1024[-0.025...]', '1024x1024[-0.0259...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 3: step = 4, loss = 0.002351124072447419, params = ['1024x1024[-0.0239...]', '1024x1024[-0.0338...]', '1024x1024[-0.024...]', '1024x1024[-0.0258...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 1: step = 4, loss = 0.002430998720228672, params = ['1024x1024[-0.0239...]', '1024x1024[-0.0338...]', '1024x1024[-0.024...]', '1024x1024[-0.0258...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 2: step = 4, loss = 0.0023390757851302624, params = ['1024x1024[-0.0239...]', '1024x1024[-0.0338...]', '1024x1024[-0.024...]', '1024x1024[-0.0258...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_main", "filename": "lecture_08.py", "lineno": 381}], "Rank 0: step = 4, loss = 0.002277878113090992, params = ['1024x1024[-0.0239...]', '1024x1024[-0.0338...]', '1024x1024[-0.024...]', '1024x1024[-0.0258...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 42}, {"name": "ddp", "filename": "lecture_08.py", "lineno": 341}], "Notes:", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 42}, {"name": "ddp", "filename": "lecture_08.py", "lineno": 342}], "- Losses are different across nodes (computed on local data)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 42}, {"name": "ddp", "filename": "lecture_08.py", "lineno": 343}], "- Gradients are same, and therefore parameters are the same", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 43}, {"name": "ddp_zero3", "filename": "lecture_08.py", "lineno": 390}], "## Distributed data parallel (DDP) with ZeRO stage 3", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 43}, {"name": "ddp_zero3", "filename": "lecture_08.py", "lineno": 392}], "https://production-media.paperswithcode.com/methods/Screen_Shot_2021-07-26_at_3.17.43_PM_3oyU7Qb.png", {"width": "50.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 43}, {"name": "ddp_zero3", "filename": "lecture_08.py", "lineno": 393}], "- ZeRO stage 1: shard optimizer state", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 43}, {"name": "ddp_zero3", "filename": "lecture_08.py", "lineno": 394}], "- ZeRO stage 2: shard optimizer state + gradients", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 43}, {"name": "ddp_zero3", "filename": "lecture_08.py", "lineno": 395}], "- ZeRO stage 3: shard optimizer state + gradients + parameters", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 43}, {"name": "ddp_zero3", "filename": "lecture_08.py", "lineno": 402}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 4)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 2: step = 0, loss = 0.01297585666179657, params = ['1024x1024[-0.0279...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 3: step = 0, loss = 0.01329837553203106, params = ['1024x1024[-0.0279...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 0: step = 0, loss = 0.012681256979703903, params = ['1024x1024[-0.0289...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 1: step = 0, loss = 0.013125395402312279, params = ['1024x1024[-0.0299...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 2: step = 1, loss = 0.004401334561407566, params = ['1024x1024[-0.0272...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 3: step = 1, loss = 0.00440523587167263, params = ['1024x1024[-0.0269...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 0: step = 1, loss = 0.004417148884385824, params = ['1024x1024[-0.0289...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 1: step = 1, loss = 0.0044257016852498055, params = ['1024x1024[-0.0305...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 2: step = 2, loss = 0.0024908652994781733, params = ['1024x1024[-0.0266...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 3: step = 2, loss = 0.0025361478328704834, params = ['1024x1024[-0.0264...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 0: step = 2, loss = 0.0025099432095885277, params = ['1024x1024[-0.0289...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 1: step = 2, loss = 0.0024995594285428524, params = ['1024x1024[-0.031...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 2: step = 3, loss = 0.0017424722900614142, params = ['1024x1024[-0.0262...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 3: step = 3, loss = 0.0018094710540026426, params = ['1024x1024[-0.0261...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 0: step = 3, loss = 0.0017867289716377854, params = ['1024x1024[-0.0289...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 1: step = 3, loss = 0.0017413360765203834, params = ['1024x1024[-0.0314...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 2: step = 4, loss = 0.0014027045108377934, params = ['1024x1024[-0.0258...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 3: step = 4, loss = 0.0014653682010248303, params = ['1024x1024[-0.0261...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 0: step = 4, loss = 0.001436941442079842, params = ['1024x1024[-0.0289...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "ddp_zero3_main", "filename": "lecture_08.py", "lineno": 515}], "Rank 1: step = 4, loss = 0.0014105464797466993, params = ['1024x1024[-0.0318...]']", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 44}, {"name": "tensor_parallelism", "filename": "lecture_08.py", "lineno": 518}], "## Tensor parallelism", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 44}, {"name": "tensor_parallelism", "filename": "lecture_08.py", "lineno": 520}], "Key idea: split the big matmul across ranks", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 44}, {"name": "tensor_parallelism", "filename": "lecture_08.py", "lineno": 521}], "Each rank will have the same data", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 44}, {"name": "tensor_parallelism", "filename": "lecture_08.py", "lineno": 528}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 4)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "tensor_parallelism_main", "filename": "lecture_08.py", "lineno": 562}], "Rank 2: forward pass produced activations 128x1024[2.7169...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "tensor_parallelism_main", "filename": "lecture_08.py", "lineno": 562}], "Rank 1: forward pass produced activations 128x1024[2.7169...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "tensor_parallelism_main", "filename": "lecture_08.py", "lineno": 562}], "Rank 0: forward pass produced activations 128x1024[2.7169...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "tensor_parallelism_main", "filename": "lecture_08.py", "lineno": 562}], "Rank 3: forward pass produced activations 128x1024[2.7169...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 45}, {"name": "pipeline_parallelism", "filename": "lecture_08.py", "lineno": 567}], "## Pipeline parallelism", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 45}, {"name": "pipeline_parallelism", "filename": "lecture_08.py", "lineno": 569}], "Key idea: each rank gets a subset of layers and all the data", {})
addImage([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 45}, {"name": "pipeline_parallelism", "filename": "lecture_08.py", "lineno": 570}], "https://pytorch.org/docs/stable/_images/pipe.png", {"width": "50.0%"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 45}, {"name": "pipeline_parallelism", "filename": "lecture_08.py", "lineno": 577}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 2)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 0: forward pass produced 32x1024[0.0295...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 0: forward pass produced 32x1024[0.5775...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 0: forward pass produced 32x1024[0.3907...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 0: forward pass produced 32x1024[0.369...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 1: forward pass produced 32x1024[0.0829...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 1: forward pass produced 32x1024[-0.02...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 1: forward pass produced 32x1024[0.1082...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 1: forward pass produced 32x1024[0.0371...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 45}, {"name": "pipeline_parallelism", "filename": "lecture_08.py", "lineno": 578}, {"name": "spawn", "filename": "lecture_08.py", "lineno": 701}], "spawn(world_size = 4)", {})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 0: forward pass produced 32x1024[1.2413...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 0: forward pass produced 32x1024[-0.0676...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 0: forward pass produced 32x1024[-0.1207...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 0: forward pass produced 32x1024[-0.1159...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 1: forward pass produced 32x1024[0.0295...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 1: forward pass produced 32x1024[0.5775...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 1: forward pass produced 32x1024[0.3907...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 1: forward pass produced 32x1024[0.369...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 2: forward pass produced 32x1024[0.1202...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 2: forward pass produced 32x1024[-0.1418...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 2: forward pass produced 32x1024[-0.1192...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 2: forward pass produced 32x1024[0.0315...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 3: forward pass produced 32x1024[0.0829...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 3: forward pass produced 32x1024[-0.02...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 3: forward pass produced 32x1024[0.1082...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "spawn_main", "filename": "spawn.py", "lineno": 116}, {"name": "_main", "filename": "spawn.py", "lineno": 129}, {"name": "_bootstrap", "filename": "process.py", "lineno": 314}, {"name": "run", "filename": "process.py", "lineno": 108}, {"name": "_wrap", "filename": "spawn.py", "lineno": 68}, {"name": "pipeline_parallelism_main", "filename": "lecture_08.py", "lineno": 618}], "Rank 3: forward pass produced 32x1024[0.0371...]", {"font-family": "monospace", "white-space": "pre"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 47}], "## Summary", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 49}], "The game: trading off", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 50}], "- memory usage (store locally) and ", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 51}], "- communication (send across GPUs)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 629}], "Overview of different parallelism strategies", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 629}], "https://github.com/stas00/ml-engineering/tree/master/training/model-parallelism", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 632}], "PyTorch FSDP", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 632}], "https://arxiv.org/pdf/2304.11277.pdf", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 633}], "DeepSpeed", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 633}], "https://www.microsoft.com/en-us/research/blog/zero-deepspeed-new-system-optimizations-enable-training-models-with-over-100-billion-parameters/", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 634}], "MegatronLM", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 634}], "https://github.com/NVIDIA/Megatron-LM", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 635}], "GPT-NeoX", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 635}], "https://github.com/EleutherAI/gpt-neox", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 636}], "Levanter", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 636}], "https://github.com/stanford-crfm/levanter", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 639}], "https://developer.nvidia.com/blog/nvidia-tools-extension-api-nvtx-annotation-tool-for-profiling-code-in-python-and-c-c/", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 642}], "https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/usage/collectives.html", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 643}], "https://pytorch.org/tutorials/intermediate/dist_tuto.html", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 646}], "Infiniband (Wikipedia)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 646}], "https://en.wikipedia.org/wiki/InfiniBand", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 647}], "Introduction to InfiniBand (whitepaper)", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 647}], "https://network.nvidia.com/pdf/whitepapers/IB_Intro_WP_190.pdf", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 648}], "Introduction to InfiniBand Networks", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 648}], "https://www.youtube.com/watch?v=2gidd6lLiH8", {"color": "gray"})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 649}], "InfiniBand", {})
addText([{"name": "lecture_08", "filename": "lecture_08.py", "lineno": 53}, {"name": "further_reading", "filename": "lecture_08.py", "lineno": 649}], "https://www.youtube.com/watch?v=wecZb5lHkXk", {"color": "gray"})
